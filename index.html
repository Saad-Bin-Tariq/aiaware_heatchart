<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heat Charts</title>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://code.jscharting.com/latest/jscharting.js"></script>
    <script src="https://code.jscharting.com/latest/modules/types.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <!-- Leaflet AJAX Plugin -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script> 
    <!-- cards icons      -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body {
        font-family: 'Roboto', sans-serif;
         }
            .card_container {
        display: flex;
            flex-wrap: wrap; /* Allow items to wrap to the next row */
            justify-content: space-between; /* Spread items out evenly */
            margin: 0 auto; /* Center the container */
            max-width: 1100px; 
    }
    
    
    
    
.dropdown-row {
      display: flex;
       /* Adjust spacing between dropdowns */
      align-items: center; /* Align items vertically */
      margin-bottom: 20px; /* Add margin between the row and other content */
      position: relative;
    }
    .dropdown {
      margin-right: 10px; /* Adjust spacing between dropdowns */
    }
    .dropdown label {
      margin-right: 5px; /* Adjust spacing between label and dropdown */
    }
    .dropdown select {
/*       width: 170px; Adjust width of dropdowns */
      padding: 5px; /* Add padding for better appearance */
      border-radius: 5px; /* Add border radius */
    }
body{
  background-image: url('https://aiaware.com.pk/wp-content/uploads/2024/02/Contour_bg.png');
  background-repeat: repeat-y;
  background-attachment: fixed;
  background-size: auto;

}
/* Container for radio buttons */
.radio-buttons {
  display: flex; /* Use flex layout */
  flex-direction: row; /* Set flex direction to row to align items horizontally */
  justify-content: flex-start; /* Align items at the start of the container */
  gap: 10px; /* Add space between radio buttons */
  align-items: center; /* Align items vertically in the center */
}

/* Hide the default radio buttons */
.radio-buttons input[type="radio"] {
  display: none;
}

/* Style for the labels */
.radio-buttons label {
  display: inline-block; /* Display labels inline */
  padding: 3px 6px; /* Padding for better spacing */
  margin: 0; /* Remove margins to keep labels close */
  font-family: Arial, sans-serif;
  font-size: 16px;
  cursor: pointer;
  border: 1px solid #ccc;
  border-radius: 5px;
  transition: background-color 0.3s; /* Smooth background color transition */
}

/* Style for checked radio buttons */
.radio-buttons input[type="radio"]:checked + label {
  background-color: #e7a833; /* Use a consistent background color */
  color: white; /* Use white text for contrast */
}

/* Add hover effect for labels */
.radio-buttons label:hover {
  background-color: #eac476ea; /* Change background color on hover */
}

/* Add focus state for labels (accessibility improvement) */
.radio-buttons label:focus {
  outline: 2px solid #0056b3; /* Highlight the label when focused */
}

.graphs{
    background-color: #e5e5e585;
    border-radius: 7px;
    padding: 5%;
    
}
.tempg{
    padding-bottom: 5%;
}
.radio-buttons{
    margin: auto;
  width: 50%;
}

#map {
        height: 400px;
      width: 100%;
      border-radius: 10px;

    }

    .card {
    width: calc(23% - 10px);
    background: linear-gradient(to right,#f1f1f1,  rgba(199, 222, 225, 0.74));
    border-radius: 10px;
    padding: 10px;
    
    margin-bottom: 20px;
    display: inline-block;
    position: relative; 
    box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;
    
  }
  .card h2 {
    margin-top: 0;
    font-family: "Arial Black", sans-serif;
    font-size: 12px;
  }
  .card p {
    margin-top: 0;
    margin-bottom: 10px;
    font-family: "Arial", sans-serif;
    font-size: 25px;
  }
  .card .date {
    margin-top: 10px;
    font-size: 10px;
    color: #555;
    font-family: "Arial", sans-serif;
  }
  .temperature-icon {
    position: absolute;
    top: 50%;
    right: 10px;
    bottom: -20px;
    transform: translateY(-30%);
    font-size: 30px; 
  }
  .humidity-icon {
    position: absolute;
    top: 50%;
    right: 20px;
    bottom: -20px;
    transform: translateY(-30%);
    font-size: 30px; 
  }
  #apiSelect {
    margin-bottom: 20px;
  }

  .gauges{
        max-width: 400px;
        height: 150px;
        padding: 5px;
        
        border-radius: 10px;
        background-color: #ffffff;
    }
.temptext{
	margin-left: 50px;
}
.humtext{
	margin-left:95px;
}
    .chart_text{
        display: flex;
  
  position: relative;
margin: 0;
margin-top: -20px;
    }
    .chart_htext{
        display: flex;
  text-align: center;
  position: relative;

margin-top: -20px;
    }
.hr{
    width: 100%;
  
}
.charts {
    position: absolute;
    right: 20px;
    top: 155px;
    width: calc(26% - 10px);
}
#indoorDropdown{
      width: auto;
    }
#outdoorDropdown{
      width: auto;
    }
#start_date{
      width: auto;
    }
.selectdate {
  display: grid;
  grid-template-columns: auto auto; /* Two columns, one for label, one for input */
  align-items: center; /* Align items vertically */
  
}
.selectdate label {
      margin-right: 5px; /* Adjust spacing between label and dropdown */
			height:auto;
    }
#map_gcontainer {
      display: flex;
      flex-wrap: wrap;

    }
    .legend-container {
            display: flex;
            flex-direction: column;
            width: 300px; /* Adjust the width as needed */
        }

        /* Style for each row */
        .legend-row {
            display: flex;
            align-items: center;
            padding: 5px;
        }

        /* Style for the image */
        .legend-row img {
            width: auto;
            height: 20px; /* Adjust height to match text height */
            margin-right: 10px; /* Space between image and text */
        }

        /* Style for the text */
        .legend-text {
            font-size: 14px;
        }
    /* Div 1 */
    #one {
      background-color:  rgba(255, 255, 255, 0.05);
      flex: 0 0 70%; /* Set width to 30% */
      box-sizing: border-box;/* Include padding in width calculation */
      margin-left: 10px;
    }

    /* Div 2 */
    #two {
      flex: 0 0 30%; /* Set width to 70% */
       /* Add padding */
      box-sizing: border-box;/* Include padding in width calculation */
    }
     /* Media query for smaller screens */
     @media (max-width: 750px) {
            .card {
                width: calc(45% - 10px); /* Set width to 50% with some margin */
            }
            #card_container {
        flex-direction: column;
      }
      #one, #two {
        flex: auto; /* Take up full width */
        min-width: auto; /* Reset minimum width */
      }
      .charts{
        position: relative;
        right: 1px;
        top: 1px;
        width: 100%;
      }
        }

    </style>
</head>
<body>
    
  <div class="card_container">
    <div class="card">
      <h2>Maximum Temperature</h2>
      <p><strong id="maxTemp"></strong></p>
      <i class="fas fa-temperature-high temperature-icon"></i>
      <hr class="hr">
      <div id="maxtdate" class="date"><i class="fas fa-calendar-alt"></i></div>
    </div>
    <div class="card">
      <h2>Minimum Temperature</h2>
      <p><strong id="minTemp"></strong></p>
      <i class="fas fa-temperature-low temperature-icon"></i>
      <hr class="hr">
      <div id="mintdate" class="date"><i class="fas fa-calendar-alt"></i></div>
    </div>
    <div class="card">
      <h2>Maximum Humidity</h2>
      <p><strong id="maxHumidity"></strong></p>
      <i class="fas fa-tint humidity-icon"></i>
      <hr class="hr">
      <div id="maxhdate" class="date"><i class="fas fa-calendar-alt"></i></div>
    </div>
    <div class="card">
      <h2>Minimum Humidity</h2>
      <p><strong id="minHumidity"></strong></p>
      <i class="fas fa-tint humidity-icon"></i>
      <hr class="hr">
      <div id="minhdate" class="date"><i class="fas fa-calendar-alt"></i></div>
    </div>
  </div>
  
   
    
      
    <div id="map_gcontainer">
    <div id="one">
        <div class="dropdown-row">
            <div class="dropdown">
              <label for="indoorDropdown">Indoor Sensors:</label>
              <select id="indoorDropdown" onchange="fetchAndRenderData()">
                <option value="">Select Sensor</option>
                <option value="1" selected>Ayesha Hostel</option>
                <option value="2">SCME</option>
                <option value="3">IGIS</option>
                <option value="4">Attar Hostel</option>
                <option value="5">DDME</option>
                <option value="6">SADA</option>
              </select>
            </div>
            <div class="dropdown">
              <label for="outdoorDropdown">Outdoor Sensors:</label>
              <select id="outdoorDropdown" onchange="fetchAndRenderData1()">
                <option value="">Select Sensor</option>
                <option value="21">Ibrahim Mess</option>
<!--                     <option value="22">Unit 2</option> -->
                <option value="23">SINES</option>
                <!-- <option value="24">NSHS</option> -->
                <option value="25">SMME</option>
                <option value="26">Razi Hostel</option>
                <option value="27">Sports Complex</option>
<!--                     <option value="41">Portable Unit 1</option>
                <option value="42">Portable Unit 2</option> -->
              </select>
            </div>   
              
            <div class="selectdate">
            <label for="start_date">Date: </label>
            <input class="inputdiv" type="date" id="start_date" name="start_date" onchange="handleFrequencyChange()"> 
            </div>
          </div>
    <div class="graphs">
        <div class="tempg">
        <div id="chart1"></div>
        <div class="radio-buttons">
            <input type="radio" id="sday" name="frequency" value="day" onchange="handleFrequencyChange()">
            <label for="sday">Single Day</label>

            <input type="radio" id="daily" name="frequency" value="daily" checked onchange="handleFrequencyChange()">
            <label for="daily">Day to Day</label>
            
            <input type="radio" id="weekly" name="frequency" value="weekly" onchange="handleFrequencyChange()">
            <label for="weekly">Weekly</label>
            
            <input type="radio" id="monthly" name="frequency" value="monthly" onchange="handleFrequencyChange()">
            <label for="monthly">Monthly</label>
        </div>
        </div>
        
        <div class="humg">
            <div id="chart3"></div>
        </div>
    </div>
</div> 
    <div id="two">
        <div class="charts">
            <h1 id="sen_name"></h1>
            <p id="sid"></p>
            <p id="cord"></p>
            <div class="chart_htext">
                <h4 >Current Reading</h4>
            </div>
            <div id="chartDiv2" class="gauges"></div>
                <div class="chart_text">
                    <h4 class="temptext">Temperature</h4>
                    <h4 class="humtext">Humidity</h4>
                </div>
            <div id="map"></div>
            <div class="legend-container">
                <!-- First row for Indoor Units -->
                <div class="legend-row">
                    <!-- Icon for Indoor Units -->
                    <img src="https://static.thenounproject.com/png/1542560-200.png" alt="Indoor Units">
                    <!-- Text for Indoor Units -->
                    <span class="legend-text">Indoor Units</span>
                </div>
                
                <!-- Second row for Outdoor Units -->
                <div class="legend-row">
                    <!-- Icon for Outdoor Units -->
                    <img src="https://cdn-icons-png.flaticon.com/512/8112/8112373.png" alt="Outdoor Units">
                    <!-- Text for Outdoor Units -->
                    <span class="legend-text">Outdoor Units</span>
                </div>
            </div>
        </div> 
    </div>
    
</div>   
</body>
<script>
     //Max min cards
function fetchCardData(apiNumber) {
            fetch(`https://backend.aiaware.com.pk/api/v1/maxmin-data/${apiNumber}`)
              .then(response => response.json())
              .then(data => {
                document.getElementById('maxTemp').innerText = data.max_temperature + '°C';
                document.getElementById('maxtdate').innerText = data.max_temperature_timestamp;
                document.getElementById('minTemp').innerText = data.min_temperature + '°C';
                document.getElementById('mintdate').innerText = data.min_temperature_timestamp;
                document.getElementById('maxHumidity').innerText = data.max_humidity + '%';
                document.getElementById('maxhdate').innerText = data.max_humidity_timestamp;
                document.getElementById('minHumidity').innerText = data.min_humidity + '%';
                document.getElementById('minhdate').innerText = data.min_humidity_timestamp;
              })
              .catch(error => console.error('Error fetching data:', error));
          }
//sensor name loc
function fetchSensorData(apiNumber) {
            fetch(`https://backend.aiaware.com.pk/api/v1/single-sensor-data/${apiNumber}`)
              .then(response => response.json())
              .then(data => {
                document.getElementById('sen_name').innerText = 'Location: '+data[0].dept_name;
                document.getElementById('sid').innerText = 'Sensor '+data[0].sensor_id;
                document.getElementById('cord').innerText = 'Latitude: '+data[0].latitude+', Longitude'+ data[0].longitude;
                
              })
              .catch(error => console.error('Error fetching data:', error));
          }
//side sensor map
var map = L.map('map',{maxZoom: 15}).setView([33.6451, 72.9910], 14);

  // Add base layer
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
  }).addTo(map);

  // Function to create marker icon based on sensor type
  function getMarkerIcon(sensorType) {
    if (sensorType === 'indoor') {
      return L.icon({
        iconUrl: 'https://static.thenounproject.com/png/1542560-200.png',
        iconSize: [30, 30],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        tooltipAnchor: [16, -28],
        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',
        shadowSize: [41, 41]
      });
    } else if (sensorType === 'outdoor') {
      return L.icon({
        iconUrl: 'https://cdn-icons-png.flaticon.com/512/8112/8112373.png',
        iconSize: [30, 30],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        tooltipAnchor: [16, -28],
        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',
        shadowSize: [41, 41]
      });
    }
  }

  // Add markers from JSON data
  var url = 'https://backend.aiaware.com.pk/api/v1/sensor-data';
  fetch(url)
    .then(response => response.json())
    .then(data => {
      data.forEach(sensor => {
        var marker = L.marker([sensor.latitude, sensor.longitude], {
          icon: getMarkerIcon(sensor.sensor_type)
        }).bindPopup('Sensor Type: ' + sensor.sensor_type + '<br>Department Name: ' + sensor.dept_name);
        marker.addTo(map);
      });
    })
    .catch(error => console.error('Error fetching data:', error));


    // function for single date temp graph
    function fetchSingleDataAndUpdateChart1(apiNumber) {
          var dateInput = document.getElementById('start_date');
          var selectedDate = dateInput.value;

         // Check if dateInput is empty
          if (!selectedDate) {
              // Get current date
              var currentDate = new Date();
              // Format current date as yyyy-mm-dd
              year = currentDate.getFullYear();
              month = String(currentDate.getMonth() + 1).padStart(2, '0'); // Months start from 0, so add 1
              day = String(currentDate.getDate()).padStart(2, '0');

              // Set current date as the value of the input
              dateInput.value = `${year}-${month}-${day}`;

              // Update selectedDate with the current date
              selectedDate = dateInput.value;
          }

          var [year, month, day] = selectedDate.split('-');
          // Convert month to integer (months start from 0)
          month = parseInt(month, 10);

          return fetch(`https://backend.aiaware.com.pk/api/v1/single-data/${apiNumber}?year=${year}&month=${month}&day=${day}`)
              .then(response => response.json()) // Parse the JSON response
              .then(data => {
                  // Validate and process the response data
                  if (!Array.isArray(data)) {
                      throw new Error('Invalid response data format. Expected an array.');
                  }

                  // Extract data array from the response
                  const dataArray = data;

                  const timestampData = [];
                  const temperatureData = [];

                  dataArray.forEach(entry => {
                      timestampData.push(entry.time_interval);
                      temperatureData.push(entry.temperature);
                  });
                  const minTemperature = Math.min(...temperatureData);
                  const maxTemperature = Math.max(...temperatureData);

                  // Adjust min and max values
                  const minTemp = minTemperature - 1;
                  const maxTemp = maxTemperature + 1;
                  // Update chart options with fetched data
                  const updatedOptions = {
                      series: [
                          { name: "Temperature", data: temperatureData }
                      ],
                      xaxis: {
                          type: 'category', // Use category type for non-datetime x-axis
                          categories: timestampData, // Use time_interval as categories
                          title: { text: 'Time Interval' }
                      },
                      yaxis: {
                          title: {
                              text: 'Temperature (°C)'
                          },
                          min: minTemp,
                          max: maxTemp
                      },
                      colors: ['#FFA30D'],
                  };

                  // Update the chart with new options
                  chart1.updateOptions(updatedOptions);
              })
              .catch(error => {
                  console.error('Error fetching data:', error);
              });
            };

         
    //function for temperature graph
    function fetchDataAndUpdateChart1(apiNumber, apiInterval) {
                return fetch(`https://backend.aiaware.com.pk/api/v1/interval-data/${apiNumber}?interval=${apiInterval}`)
                    .then(response => response.json()) // Parse the JSON response
                    .then(data => {
                    // Validate and process the response data
                    if (!Array.isArray(data)) {
                        throw new Error('Invalid response data format. Expected an array.');
                    }
    
                    const timestampData = [];
                    const temperatureData = [];
    
                    // Determine the number of time slots available in the data
                    const numTimeSlots = Object.keys(data[0]).filter(key => key.startsWith('time')).length;
    
                    // Initialize temperatureData array based on the number of time slots
                    for (let i = 0; i < numTimeSlots; i++) {
                        temperatureData.push([]);
                    }
    
                    data.forEach(entry => {
                        let p_date;
                        if (apiInterval === 'daily') {
                        p_date = `${entry.year}/${entry.month}/${entry.date}`;
                        } else if (apiInterval === 'weekly') {
                        p_date = `${entry.year}/${entry.month}/${entry.week}`;
                        } else if (apiInterval === 'monthly') {
                        p_date = `${entry.year}/${entry.month}`;
                        }
    
                        for (let i = 1; i <= 5; i++) {
                        const timeSlot = entry[`time${i}`];
                        // Check if timeSlot is defined and has a 'temperature' property
                        const temperature = timeSlot && typeof timeSlot === 'object' && 'temperature' in timeSlot ? timeSlot.temperature : 0;
    
                        // Add temperature for each time slot
                        temperatureData[i - 1].push(temperature);
                        }
    
                        // Add combined date for each data point
                        timestampData.push(p_date);
                    });
    
                    // Update chart options with fetched data
                    const updatedOptions = {
                        series: [
                        { name: "12 am - 6am", data: temperatureData[0] },
                        { name: "6am - 12pm", data: temperatureData[1] },
                        { name: "12pm - 6 pm", data: temperatureData[2] },
                        { name: "6pm - 12am", data: temperatureData[3] },
                        { name: "Daily Average", data: temperatureData[4] }
                        ],
                        xaxis: {
                        type: 'category', // Use category type for non-datetime x-axis
                        categories: timestampData, // Use date string as categories
                        title: { text: 'Date' }
                        },
                        colors: ['#92c5de', '#d1e5f0', '#fddbc7', '#f4a582', '#b2182b'],
                        dataLabels: {
                          enabled: false,
                        },
                        stroke: {
                          curve: 'smooth'
                        },
                        title: {
                          text: 'Temperature Trend',
                          align: 'centre'
                        },
                        grid: {
                          borderColor: '#e7e7e7',
                          row: {
                            colors: ['#f3f3f3', 'transparent'],
                            opacity: 0.3
                          },
                        },
                        markers: {
                          size: 1
                        },
                        
                        yaxis: {
                          title: {
                            text: 'Temperature (°C)'
                          },
                          min: 0,
                          max: 40
                        },
                    };
    
                    // Update the chart with new options
                    chart1.updateOptions(updatedOptions);
                    })
                    .catch(error => {
                    console.error('Error fetching data:', error);
                    });
                };
    
    
              // ApexCharts initial options
              var options1 = {
                series: [],
                chart: {
                  height: 350,
                  type: 'line',
                  toolbar: {
                    show: true
                  }
                },
                
                   };
    
              // Initialize ApexCharts
              var chart1 = new ApexCharts(document.querySelector("#chart1"), options1);
              chart1.render();
  
              
    //function for single day humididty
    function fetchSingleDataAndUpdateChart3(apiNumber) {
          var dateInput = document.getElementById('start_date');
          var selectedDate = dateInput.value;

         // Check if dateInput is empty
          if (!selectedDate) {
              // Get current date
              var currentDate = new Date();
              // Format current date as yyyy-mm-dd
              year = currentDate.getFullYear();
              month = String(currentDate.getMonth() + 1).padStart(2, '0'); // Months start from 0, so add 1
              day = String(currentDate.getDate()).padStart(2, '0');

              // Set current date as the value of the input
              dateInput.value = `${year}-${month}-${day}`;

              // Update selectedDate with the current date
              selectedDate = dateInput.value;
          }

          var [year, month, day] = selectedDate.split('-');
          // Convert month to integer (months start from 0)
          month = parseInt(month, 10);

          return fetch(`https://backend.aiaware.com.pk/api/v1/single-data/${apiNumber}?year=${year}&month=${month}&day=${day}`)
              .then(response => response.json()) // Parse the JSON response
              .then(data => {
                  // Validate and process the response data
                  if (!Array.isArray(data)) {
                      throw new Error('Invalid response data format. Expected an array.');
                  }

                  // Extract data array from the response
                  const dataArray = data;

                  const timestampData = [];
                  const humidityData = [];

                  dataArray.forEach(entry => {
                      timestampData.push(entry.time_interval);
                      humidityData.push(entry.humidity);
                  });
                  
                  // Update chart options with fetched data
                  const updatedOptions = {
                      series: [
                          { name: "Humidity", data: humidityData }
                      ],
                      xaxis: {
                          type: 'category', // Use category type for non-datetime x-axis
                          categories: timestampData, // Use time_interval as categories
                          title: { text: 'Time Interval' }
                      },
                      yaxis: {
                          title: {
                              text: 'Humidity (%)'
                          },
                          min: 0,
                          max: 100
                      },
                      colors: ['#1f4fd1'],
                  };

                  // Update the chart with new options
                  chart3.updateOptions(updatedOptions);
              })
              .catch(error => {
                  console.error('Error fetching data:', error);
              });
            };

    
              
    //function for humidity graph
    function fetchDataAndUpdateChart3(apiNumber, apiInterval) {
                return fetch(`https://backend.aiaware.com.pk/api/v1/interval-data/${apiNumber}?interval=${apiInterval}`)
                    .then(response => response.json()) // Parse the JSON response
                    .then(data => {
                    // Validate and process the response data
                    if (!Array.isArray(data)) {
                        throw new Error('Invalid response data format. Expected an array.');
                    }
    
                    const timestampData = [];
                    const humidityData = [];
    
                    // Determine the number of time slots available in the data
                    const numTimeSlots = Object.keys(data[0]).filter(key => key.startsWith('time')).length;
    
                    // Initialize humidity Data array based on the number of time slots
                    for (let i = 0; i < numTimeSlots; i++) {
                        humidityData.push([]);
                    }
    
                    data.forEach(entry => {
                        let p_date;
                        if (apiInterval === 'daily') {
                        p_date = `${entry.year}/${entry.month}/${entry.date}`;
                        } else if (apiInterval === 'weekly') {
                        p_date = `${entry.year}/${entry.month}/${entry.week}`;
                        } else if (apiInterval === 'monthly') {
                        p_date = `${entry.year}/${entry.month}`;
                        }
    
                        for (let i = 1; i <= 5; i++) {
                        const timeSlot = entry[`time${i}`];
                        // Check if timeSlot is defined and has a 'humidity' property
                        const humidity = timeSlot && typeof timeSlot === 'object' && 'humidity' in timeSlot ? timeSlot.humidity : 0;
    
                        // Add temperature for each time slot
                        humidityData[i - 1].push(humidity);
                        }
    
                        // Add combined date for each data point
                        timestampData.push(p_date);
                    });
    
                    // Update chart options with fetched data
                    const updatedOptions = {
                        series: [
                        { name: "12 am - 6am", data: humidityData[0] },
                        { name: "6am - 12pm", data: humidityData[1] },
                        { name: "12pm - 6 pm", data: humidityData[2] },
                        { name: "6pm - 12am", data: humidityData[3] },
                        { name: "Daily Average", data: humidityData[4] }
                        ],
                        xaxis: {
                        type: 'category', // Use category type for non-datetime x-axis
                        categories: timestampData, // Use date string as categories
                        title: { text: 'Date' }
                        },
                              
                      colors: ['#1f4fd1', '#40a7db', '#f0c678', '#9fd6ed', '#bebfc2'],
                      dataLabels: {
                        enabled: false,
                      },
                      stroke: {
                        curve: 'smooth'
                      },
                      title: {
                        text: 'Humidity Trend',
                        align: 'centre'
                      },
                      grid: {
                        borderColor: '#e7e7e7',
                        row: {
                          colors: ['#f3f3f3', 'transparent'],
                          opacity: 0.3
                        },
                      },
                      markers: {
                        size: 1
                      },
                      
                      yaxis: {
                        title: {
                          text: 'Humidity (%)'
                        },
                        min: 0,
                        max: 100
                      },
                    };
    
                    // Update the chart with new options
                    chart3.updateOptions(updatedOptions);
                    })
                    .catch(error => {
                    console.error('Error fetching data:', error);
                    });
                };
    
    
              // ApexCharts initial options
              var options3 = {
                series: [],
                chart: {
                  height: 350,
                  type: 'line',
                  toolbar: {
                    show: true
                  }
                },
                   };
    
              // Initialize ApexCharts
              var chart3 = new ApexCharts(document.querySelector("#chart3"), options3);
              chart3.render();
    
 
    //calling both graph functions
            function handleFrequencyChange() {
                if(outdoorDropdown.value == ""){fetchAndRenderData()};
                if(indoorDropdown.value == ""){fetchAndRenderData1()};
            }
    
 
    //calling graphs on indoor change
              function fetchAndRenderData() {
                const selectedApi = document.getElementById('indoorDropdown').value;
    
                const radioButtons = document.getElementsByName('frequency');
                outdoorDropdown.value = "";
                // Initialize a variable to store the selected value
                let selectedValue = '';
    
                // Iterate through the radio buttons to find the selected one
                radioButtons.forEach(radioButton => {
                if (radioButton.checked) {
                    selectedValue = radioButton.value;
                }
                });
               
                fetchCardData(selectedApi);
								fetchSensorData(selectedApi);
                if(selectedValue=='day'){
                  fetchSingleDataAndUpdateChart1(selectedApi);
                  fetchSingleDataAndUpdateChart3(selectedApi);
                }else{
                  fetchDataAndUpdateChart1(selectedApi, selectedValue);
                  fetchDataAndUpdateChart3(selectedApi, selectedValue);
                }
                
                fetchDataAndUpdateChart2(selectedApi); // Update Chart 2 as well
                
              }
    
    //calling graphs on indoor change
              function fetchAndRenderData1() {
                const selectedApi = document.getElementById('outdoorDropdown').value;
                const radioButtons = document.getElementsByName('frequency');
                indoorDropdown.value = "";
                // Initialize a variable to store the selected value
                let selectedValue = '';
    
                // Iterate through the radio buttons to find the selected one
                radioButtons.forEach(radioButton => {
                if (radioButton.checked) {
                    selectedValue = radioButton.value;
                }
                });
                fetchCardData(selectedApi);
								fetchSensorData(selectedApi);
                if(selectedValue=='day'){
                  fetchSingleDataAndUpdateChart1(selectedApi);
                  fetchSingleDataAndUpdateChart3(selectedApi);
                }else{
                  fetchDataAndUpdateChart1(selectedApi, selectedValue);
                  fetchDataAndUpdateChart3(selectedApi, selectedValue);
                }
                fetchDataAndUpdateChart2(selectedApi); // Update Chart 2 as well
              }
              
              // Fetch and render data on page load
              fetchAndRenderData();
    
              function fetchDataAndUpdateChart2(apiNumber) {
          return fetch(`https://backend.aiaware.com.pk/api/v1/latest-data/${apiNumber}`)
            .then(response => response.json())
            .then(data => {
              const temperature = data[0].temperature;
              const humidity = data[0].humidity;
              chart2.series('Temperature').options({ points: [['(°C)',temperature]] });
              chart2.series('Humidity').options({ points: [['(%)', humidity]] });
            })
            .catch(error => {
              console.error('Error fetching data:', error);
            });
        }

        var chart2 = JSC.chart('chartDiv2', {
          debug: true,
          legend_visible: false,
          defaultTooltip_enabled: true,
          xAxis_spacingPercentage: 0.4,
          yAxis: [
            {
              id: 'ax1',
              defaultTick: { padding: 10, enabled: false },
              customTicks: [0, 10, 20, 30, 40],
              line: {
                width: 10,
                breaks:{},
                color: 'smartPalette:pal1'
              },
              scale_range: [0, 40]
            },
            {
              id: 'ax2',
              scale_range: [0, 100],
              defaultTick: { padding: 10, enabled: false },
              customTicks: [0, 20, 40, 60, 80, 100],
              line: { width: 10, color: 'smartPalette:pal2' }
            }
          ],
          defaultSeries: {
            type: 'gauge column roundcaps',
            shape: {
              label: {
                text: '%max',
                align: 'center',
                verticalAlign: 'middle',
                style_fontSize: 15
              }
            }
          },
          series: [
            {
              type: 'column roundcaps 1',
              name: 'Temperature',
              yAxis: 'ax1',
              palette: {
                id: 'pal1',
                pointValue: '{%yValue/40}',
                colors: [
                  '#C3F584',
                  '#96CD39',
                  '#FFE400',
                  '#FFBA47',
                  '#FF1700'
                ]
              }, 
              shape: {
                label: {
                  text: '%max°C',
                  align: 'center',
                  verticalAlign: 'middle',
                  style_fontSize: 15
                }
              } 
              
            },
            {
              type: 'column roundcaps 2',
              yAxis: 'ax2',
              name: 'Humidity',
              palette: {
                id: 'pal2',
                pointValue: '{%yValue/100}',
                colors: [
                  '#ffffd9',
                  '#edf8b0',
                  '#c7e9b4',
                  '#7fcdbb',
                  '#41b6c3',
                  '#1d91c0',
                  '#225ea8',
                  '#253494',
                  '#081d58'
                ]
              },
              shape: {
                label: {
                  text: '%max%',
                  align: 'center',
                  verticalAlign: 'middle',
                  style_fontSize: 15
                }
              }
            }
          ]
        });
    
        function fetchAndRenderData2(apiNumber) {
          fetchDataAndUpdateChart2(apiNumber);
        }
        
       
        fetchAndRenderData2(1); // Default to API 1
        setInterval(fetchAndRenderData2, 60000); 
         
</script>
</html>
